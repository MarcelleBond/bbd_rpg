<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <!--/*@thymesVar id="message" type="java.lang.String"*/-->
    <title th:text="${message}">Title</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" th:src="@{webjars/jquery/3.1.1-1/jquery.min.js}"></script>
    <script th:src="@{webjars/sockjs-client/1.0.2/sockjs.min.js}"></script>
    <script th:src="@{webjars/stomp-websocket/2.3.3/stomp.min.js}"></script>
</head>
<body>
    <button id="connect">Connect</button>
    <button id="disconnect">Disconnect</button>
    <h1>Welcome to the RPG</h1>
    <h2 class="status"></h2>
    <input type="text" name="name" id="name">
    <input type="text" name="level" id="level">
    <input type="text" name="status" id="status">
    <button id="submit">Submit</button>
    <!--/*@thymesVar id="map" type="java.util.List"*/-->
    <span style="display: inline-block" th:each="row : ${map}" class="tile">
        <span th:each="col : ${row}" th:class="(${col} == '1') ? 'wall': 'space'">0</span>
    </span>
</body>
</html>

<style>
    .wall {
        padding: 2px;
        width: 5px;
        background-color: black;
    }
    .space {
        color: green;
        padding: 2px;
        width: 5px;
        background-color: green;
    }
</style>

<script>
    let stompClient = null;

    function setConnected(connected) {
        if (!connected)
            $(".status").html("Not connected");
        else
            $(".status").html("");
    }

    function connect() {
        let socket = new SockJS('/gs-guide-websocket');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, (frame) => {
            setConnected(true);
            console.log('Connected: ', frame);
            stompClient.subscribe('/player/status', (status) => {
                showStatus(JSON.parse(status.body).content);
            })
        })
    }

    function disconnect() {
        if (stompClient !== null)
            stompClient.disconnect();
        setConnected(false);
        console.log('Disconnected');
    }

    function sendStatus() {
        stompClient.send('/app/status', {}, JSON.stringify({
            'name': $("#name").val(),
            'level': $("#level").val(),
            'status': $("#status").val()
        }));
    }

    function showStatus(status) {
        $('.status').html(status);
    }

    $(() => {
        alert("hello!!!!");
        $("#connect").click(() => connect());
        $("#disconnect").click(() => disconnect());
        $("#submit").click(() => sendStatus());
    });
</script>